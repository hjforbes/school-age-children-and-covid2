----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\school-age-children-and-covid\analysis\log\an_multivariableFULL_cox_models_covid_deathSense1.log
  log type:  text
 opened on:  24 Jul 2020, 13:43:49

. 
. use "$tempdir\cr_create_analysis_dataset_STSET_`outcome'.dta", clear

. 
. 
. ******************************
. *  Multivariable Cox models  *
. ******************************
. 
. *************************************************************************************
. *PROG TO DEFINE THE BASIC COX MODEL WITH OPTIONS FOR HANDLING OF AGE, BMI, ETHNICITY:
. cap prog drop basecoxmodel

. prog define basecoxmodel
  1.         syntax , exposure(string) age(string) [ethnicity(real 0) if(string)] bmi(string) smoking(string)
  2. 
.         if `ethnicity'==1 local ethnicity "i.ethnicity"
  3.         else local ethnicity
  4. timer clear
  5. timer on 1
  6.         capture stcox   `exposure' `age'                ///
>                         i.male                                                  ///
>                         `bmi'                                                   ///
>                         `smoking'                                               ///
>                         `ethnicity'                                             ///
>                         i.imd                                                   ///
>                         i.htdiag_or_highbp                              ///
>                         i.chronic_respiratory_disease   ///
>                         i.asthma                                                ///
>                         i.chronic_cardiac_disease               ///
>                         i.diabetes                                              ///
>                         i.cancer_exhaem_cat                             ///
>                         i.cancer_haem_cat                               ///
>                         i.chronic_liver_disease                 ///
>                         i.stroke_dementia                               ///
>                         i.other_neuro                                   ///
>                         i.reduced_kidney_function_cat   ///
>                         i.organ_trans                                   ///
>                         i.tot_adults_hh                                 ///
>                         i.asplenia                                              ///
>                         i.ra_sle_psoriasis                      ///
>                         i.other_immuno                                  ///
>                         `if'                                                    ///
>                         , strata(stp) vce(cluster household_id)
  7. timer off 1
  8. timer list
  9. end

. *************************************************************************************
. 
. foreach exposure_type in        kids_cat3  ///
>                 gp_number_kids {
  2. 
. 
. *Complete case ethnicity model
. basecoxmodel, exposure("i.`exposure_type'") age("age1 age2 age3") ethnicity(1) bmi(i.obese4cat) smoking(i.smoke_nomiss)
  3. if _rc==0{
  4. estimates
  5. estimates save ./output/an_multivariate_cox_models_`outcome'_`exposure_type'_MAINFULLYADJMODEL_CCeth, replace
  6. *estat concordance /*c-statistic*/
.  }
  7.  else di "WARNING CC ETHNICITY MODEL WITH AGESPLINE DID NOT FIT (OUTCOME `outcome')"
  8. 
.  }
   1:    108.25 /        1 =     108.2450

----------------------------------------------------------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =    9,529,274             Number of obs    =     286,953
No. of failures      =        1,108
Time at risk         =   1295524605
                                                Wald chi2(41)    =     3590.96
Log pseudolikelihood =   -12639.194             Prob > chi2      =      0.0000

                                      (Std. Err. adjusted for 282,420 clusters in household_id)
-----------------------------------------------------------------------------------------------
                              |               Robust
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                    kids_cat3 |
               Kids under 12  |   .7203672   .0795476    -2.97   0.003     .5801746    .8944357
               Kids under 18  |     .81485    .105388    -1.58   0.113     .6323946    1.049946
                              |
                         age1 |   1.165374   .0683212     2.61   0.009     1.038874    1.307278
                         age2 |   .9116036   .1420256    -0.59   0.552     .6717241    1.237147
                         age3 |   1.004335   .4439626     0.01   0.992     .4222871    2.388631
                       1.male |   1.959714   .1345527     9.80   0.000     1.712969       2.242
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.180903   .0994288     1.97   0.048     1.001256    1.392782
          Obese II (35-39.9)  |   1.959931   .1988666     6.63   0.000      1.60647    2.391161
             Obese III (40+)  |   2.255906    .286722     6.40   0.000     1.758468    2.894058
                              |
                 smoke_nomiss |
                      Former  |   1.059115   .0756434     0.80   0.421     .9207661    1.218252
                     Current  |   .6421633   .0653818    -4.35   0.000     .5259936    .7839899
                              |
                    ethnicity |
                       Mixed  |   2.474486   .5181882     4.33   0.000     1.641469    3.730244
      Asian or Asian British  |   2.177107   .2303011     7.35   0.000     1.769445    2.678691
                       Black  |   2.511994     .32946     7.02   0.000     1.942583    3.248312
                       Other  |    2.02701    .365499     3.92   0.000     1.423547    2.886288
                              |
                          imd |
                           2  |   1.226111   .1541391     1.62   0.105     .9583448    1.568691
                           3  |   1.400082   .1689879     2.79   0.005     1.105133    1.773749
                           4  |   1.848676   .2128773     5.34   0.000     1.475176    2.316742
             5 most deprived  |   1.695386   .2103753     4.25   0.000     1.329369    2.162179
                              |
           1.htdiag_or_highbp |   1.207054    .086791     2.62   0.009      1.04839    1.389732
1.chronic_respiratory_disease |   2.731955   .2844742     9.65   0.000     2.227611    3.350487
                     1.asthma |   1.121715   .0942942     1.37   0.172     .9513237    1.322625
    1.chronic_cardiac_disease |   1.520743   .1468412     4.34   0.000     1.258534    1.837582
                   1.diabetes |   2.206753   .1736436    10.06   0.000     1.891363    2.574735
                              |
            cancer_exhaem_cat |
                   Last year  |   4.174814    .934951     6.38   0.000     2.691598    6.475361
               2-5 years ago  |   2.412682   .4401086     4.83   0.000     1.687441    3.449624
                    5+ years  |   1.626886   .2817502     2.81   0.005     1.158625    2.284396
                              |
              cancer_haem_cat |
                   Last year  |   7.744066   3.610921     4.39   0.000     3.105051    19.31387
               2-5 years ago  |   7.301254    2.28793     6.34   0.000     3.950608     13.4937
                    5+ years  |   2.305974   .7260556     2.65   0.008     1.244075    4.274275
                              |
      1.chronic_liver_disease |   3.116999   .5352911     6.62   0.000     2.226166    4.364314
            1.stroke_dementia |   1.874238   .2776917     4.24   0.000     1.401873    2.505768
                1.other_neuro |   4.759518   .7817295     9.50   0.000     3.449507     6.56703
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   2.447452   .2907404     7.53   0.000     1.939088    3.089094
           Stage 4/5 egfr<30  |   8.781977     1.6735    11.40   0.000     6.044866    12.75845
                              |
                1.organ_trans |   2.120555   .5494475     2.90   0.004     1.276141    3.523713
                              |
                tot_adults_hh |
                           2  |    .804687   .0681996    -2.56   0.010     .6815303     .950099
                           3  |   1.006696    .083906     0.08   0.936     .8549736    1.185344
                              |
                   1.asplenia |   1.410007    .764467     0.63   0.526     .4872176    4.080556
           1.ra_sle_psoriasis |   1.398544   .1596416     2.94   0.003     1.118182      1.7492
               1.other_immuno |   1.959018   .5312675     2.48   0.013     1.151332    3.333315
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/an_multivariate_cox_models_covid_death_kids_cat3_MAINFULLYADJMODEL_CCeth.ster not found)
file ./output/an_multivariate_cox_models_covid_death_kids_cat3_MAINFULLYADJMODEL_CCeth.ster saved
   1:     96.87 /        1 =      96.8680

----------------------------------------------------------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =    9,529,274             Number of obs    =     286,953
No. of failures      =        1,108
Time at risk         =   1295524605
                                                Wald chi2(43)    =     3591.53
Log pseudolikelihood =    -12637.71             Prob > chi2      =      0.0000

                                      (Std. Err. adjusted for 282,420 clusters in household_id)
-----------------------------------------------------------------------------------------------
                              |               Robust
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
               gp_number_kids |
              only >12 years  |   .8140062    .105302    -1.59   0.112     .6317045    1.048918
                 1 child <12  |   .8093797   .1018646    -1.68   0.093     .6324471    1.035811
              2 children <12  |   .6049933   .1160355    -2.62   0.009     .4154255     .881065
             3+ children <12  |   .5512159   .1865742    -1.76   0.078     .2839287    1.070124
                              |
                         age1 |   1.168815   .0684395     2.66   0.008     1.042088    1.310955
                         age2 |   .9019461   .1406186    -0.66   0.508     .6644669      1.2243
                         age3 |    1.04123   .4612052     0.09   0.927     .4370316    2.480734
                       1.male |   1.958928   .1344652     9.80   0.000      1.71234    2.241026
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.182104   .0995566     1.99   0.047     1.002231     1.39426
          Obese II (35-39.9)  |   1.964423   .1990329     6.66   0.000     1.610617     2.39595
             Obese III (40+)  |   2.253944   .2864609     6.39   0.000     1.756957    2.891512
                              |
                 smoke_nomiss |
                      Former  |   1.057825   .0755415     0.79   0.431     .9196614    1.216746
                     Current  |   .6408734   .0652436    -4.37   0.000     .5249482    .7823987
                              |
                    ethnicity |
                       Mixed  |   2.485345   .5201808     4.35   0.000     1.649038    3.745782
      Asian or Asian British  |    2.18677   .2315544     7.39   0.000      1.77693    2.691137
                       Black  |   2.515763    .330362     7.03   0.000      1.94488     3.25422
                       Other  |   2.028748   .3658453     3.92   0.000     1.424723    2.888855
                              |
                          imd |
                           2  |   1.226019   .1541591     1.62   0.105     .9582247    1.568653
                           3  |   1.400373   .1690178     2.79   0.005     1.105371    1.774106
                           4  |   1.846546   .2126753     5.33   0.000     1.473409    2.314179
             5 most deprived  |   1.698382   .2105429     4.27   0.000     1.332032     2.16549
                              |
           1.htdiag_or_highbp |   1.206835    .086754     2.62   0.009     1.048236    1.389431
1.chronic_respiratory_disease |    2.73572   .2845134     9.68   0.000     2.231244    3.354255
                     1.asthma |   1.123522    .094361     1.39   0.166     .9529981    1.324559
    1.chronic_cardiac_disease |   1.523957   .1470014     4.37   0.000     1.261437    1.841111
                   1.diabetes |   2.203426   .1735053    10.03   0.000     1.888304    2.571135
                              |
            cancer_exhaem_cat |
                   Last year  |    4.18045   .9363315     6.39   0.000     2.695082    6.484463
               2-5 years ago  |   2.403418    .438493     4.81   0.000     1.680859    3.436586
                    5+ years  |   1.622403   .2812618     2.79   0.005      1.15503    2.278893
                              |
              cancer_haem_cat |
                   Last year  |   7.742308     3.6153     4.38   0.000     3.100264    19.33491
               2-5 years ago  |   7.303555   2.289464     6.34   0.000      3.95099     13.5009
                    5+ years  |   2.309375   .7278156     2.66   0.008     1.245181    4.283084
                              |
      1.chronic_liver_disease |   3.114306   .5353753     6.61   0.000     2.223477    4.362044
            1.stroke_dementia |   1.867712   .2770798     4.21   0.000     1.396471    2.497973
                1.other_neuro |   4.751244   .7807906     9.48   0.000     3.442913     6.55675
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   2.450533   .2910222     7.55   0.000     1.941659    3.092774
           Stage 4/5 egfr<30  |   8.879826   1.693602    11.45   0.000     6.110255    12.90475
                              |
                1.organ_trans |   2.111571   .5473687     2.88   0.004      1.27044    3.509596
                              |
                tot_adults_hh |
                           2  |   .8056365   .0682712    -2.55   0.011     .6823492    .9511995
                           3  |   1.008194   .0839605     0.10   0.922     .8563624    1.186945
                              |
                   1.asplenia |   1.409813   .7644685     0.63   0.526     .4870783      4.0806
           1.ra_sle_psoriasis |   1.394993   .1592321     2.92   0.004      1.11535    1.744748
               1.other_immuno |   1.939321   .5268311     2.44   0.015     1.138714    3.302821
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/an_multivariate_cox_models_covid_death_gp_number_kids_MAINFULLYADJMODEL_CCeth.ster not found)
file ./output/an_multivariate_cox_models_covid_death_gp_number_kids_MAINFULLYADJMODEL_CCeth.ster saved

. 
. 
. log close
      name:  <unnamed>
       log:  E:\analyses\school-age-children-and-covid\analysis\log\an_multivariableFULL_cox_models_covid_deathSense1.log
  log type:  text
 closed on:  24 Jul 2020, 13:47:25
----------------------------------------------------------------------------------------------------------------------------------

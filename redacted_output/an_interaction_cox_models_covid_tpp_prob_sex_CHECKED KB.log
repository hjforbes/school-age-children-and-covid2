----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\school-age-children-and-covid\analysis\log\an_interaction_cox_models_covid_tpp_prob_sex.log
  log type:  text
 opened on:  24 Jul 2020, 13:43:52

. 
. 
. use "$tempdir\cr_create_analysis_dataset_STSET_`outcome'.dta", clear

. stset
-> stset stime_covid_tpp_prob [pweight=pw], id(patient_id)
                              failure(covid_tpp_prob) enter(time enter_date)
                              origin(time enter_date)

                id:  patient_id
     failure event:  covid_tpp_prob != 0 & covid_tpp_prob < .
obs. time interval:  (stime_covid_tpp_prob[_n-1], stime_covid_tpp_prob]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date
            weight:  [pweight=pw]

------------------------------------------------------------------------------
    397,151  total observations
          0  exclusions
------------------------------------------------------------------------------
    397,151  observations remaining, representing
    397,151  subjects
     23,055  failures in single-failure-per-subject data
   52961958  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       136

. 
.         
. *PROG TO DEFINE THE BASIC COX MODEL WITH OPTIONS FOR HANDLING OF AGE, BMI, ETHNICITY:
. cap prog drop basemodel

. prog define basemodel
  1.         syntax , exposure(string)  age(string) [ethnicity(real 0) interaction(string)] 
  2.         if `ethnicity'==1 local ethnicity "i.ethnicity"
  3.         else local ethnicity
  4. timer clear
  5. timer on 1
  6.  stcox  `exposure' `age'                                        ///
>                         i.male                                                  ///
>                         i.obese4cat                                             ///
>                         i.smoke_nomiss                                  ///
>                         i.imd                                                   ///
>                         i.htdiag_or_highbp                              ///
>                         i.chronic_respiratory_disease   ///
>                         i.asthma                                                ///
>                         i.chronic_cardiac_disease               ///
>                         i.diabetes                                              ///
>                         i.cancer_exhaem_cat                             ///
>                         i.cancer_haem_cat                               ///
>                         i.chronic_liver_disease                 ///
>                         i.stroke_dementia                               ///
>                         i.other_neuro                                   ///
>                         i.reduced_kidney_function_cat   ///
>                         i.organ_trans                           ///
>                         i.asplenia                                              ///
>                         i.tot_adults_hh                         ///
>                         i.ra_sle_psoriasis                      ///
>                         i.other_immuno                  ///
>                         `interaction'                                                   ///
>                         , strata(stp) vce(cluster household_id)
  7.         timer off 1
  8. timer list
  9. end

. *************************************************************************************
. 
. foreach int_type in  male  {
  2. 
. *Age interaction for 3-level exposure vars
. foreach exposure_type in kids_cat3  {
  3. 
. *Age spline model (not adj ethnicity, no interaction)
. basemodel, exposure("i.`exposure_type'") age("age1 age2 age3")  
  4. 
. *Age spline model (not adj ethnicity, interaction)
. basemodel, exposure("i.`exposure_type'") age("age1 age2 age3") interaction(1.`int_type'#1.`exposure_type' 1.`int_type'#2.`exposu
> re_type')
  5. if _rc==0{
  6. testparm 1.`int_type'#i.`exposure_type'
  7. di _n "`exposure_type' <66" _n "****************"
  8. lincom 2.`exposure_type', eform
  9. di "`exposure_type' 66+" _n "****************"
 10. lincom 2.`exposure_type' + 1.`int_type'#2.`exposure_type', eform
 11. estimates save ./output/an_interaction_cox_models_`outcome'_`exposure_type'_`int_type'_MAINFULLYADJMODEL_agespline_bmicat_noe
> th, replace
 12. }
 13. else di "WARNING GROUP MODEL DID NOT FIT (OUTCOME `outcome')"
 14. 
. }
 15. 
. /*Age interactions with 4-level vars: NOT in protocol - do not run
> foreach exposure_type in gp_number_kids {
> basemodel, exposure("i.`exposure_type'") age("age1 age2 age3")  bp("i.htdiag_or_highbp") ethnicity(0) interaction(1.`int_type'#1
> .`exposure_type' 1.`int_type'#2.`exposure_type' 1.`int_type'#3.`exposure_type' 1.`int_type'#4.`exposure_type')
> if _rc==0{
> testparm 1.`int_type'#i.`exposure_type'
> di _n "`exposure_type' <66" _n "****************"
> lincom 2.`exposure_type', eform
> lincom 3.`exposure_type', eform
> lincom 4.`exposure_type', eform
> di "`exposure_type' 66+" _n "****************"
> lincom 2.`exposure_type' + 1.`int_type'#2.`exposure_type', eform
> lincom 3.`exposure_type' + 1.`int_type'#3.`exposure_type', eform
> lincom 4.`exposure_type' + 1.`int_type'#4.`exposure_type', eform
> estimates save ./output/an_interaction_cox_models_`outcome'_`exposure_type'_`int_type'_MAINFULLYADJMODEL_agespline_bmicat_noeth,
>  replace
> }
> else di "WARNING GROUP MODEL DID NOT FIT (OUTCOME `outcome')"
> }
> */
. 
. }

         failure _d:  covid_tpp_prob
   analysis time _t:  (stime_covid_tpp_prob-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id
             weight:  [pweight=pw]

(sum of wgt is 12,492,921.190979)
Iteration 0:   log pseudolikelihood = -303880.32
Iteration 1:   log pseudolikelihood = -301471.38
Iteration 2:   log pseudolikelihood = -299356.51
Iteration 3:   log pseudolikelihood = -298993.83
Iteration 4:   log pseudolikelihood = -298931.99
Iteration 5:   log pseudolikelihood = -298928.16
Iteration 6:   log pseudolikelihood = -298928.13
Refining estimates:
Iteration 0:   log pseudolikelihood = -298928.13

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =   12,492,921             Number of obs    =     397,151
No. of failures      =       23,055
Time at risk         =   1697424492
                                                Wald chi2(37)    =     9580.68
Log pseudolikelihood =   -298928.13             Prob > chi2      =      0.0000

                                      (Std. Err. adjusted for 387,798 clusters in household_id)
-----------------------------------------------------------------------------------------------
                              |               Robust
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                    kids_cat3 |
               Kids under 12  |    1.07898   .0204835     4.00   0.000     1.039571    1.119883
               Kids under 18  |   1.128481   .0283674     4.81   0.000      1.07423    1.185473
                              |
                         age1 |   1.054726   .0051654    10.88   0.000      1.04465    1.064899
                         age2 |   .9214652   .0146735    -5.14   0.000     .8931498    .9506783
                         age3 |   1.072476    .059793     1.26   0.209     .9614601    1.196311
                       1.male |   .7347967    .010321   -21.94   0.000     .7148438    .7553066
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.320176   .0255515    14.35   0.000     1.271034    1.371218
          Obese II (35-39.9)  |   1.476337    .038741    14.85   0.000     1.402326    1.554255
             Obese III (40+)  |    1.61277   .0519934    14.83   0.000     1.514017    1.717963
                              |
                 smoke_nomiss |
                      Former  |   .9638604   .0155678    -2.28   0.023      .933826    .9948607
                     Current  |   .5595259   .0123708   -26.26   0.000     .5357974    .5843052
                              |
                          imd |
                           2  |   1.125743    .027549     4.84   0.000     1.073022    1.181054
                           3  |   1.158731   .0286163     5.97   0.000      1.10398    1.216197
                           4  |   1.317918   .0317688    11.45   0.000       1.2571    1.381678
             5 most deprived  |   1.505073   .0376239    16.35   0.000     1.433109    1.580651
                              |
           1.htdiag_or_highbp |   1.189798   .0204419    10.11   0.000       1.1504    1.230546
1.chronic_respiratory_disease |   1.938479   .0694002    18.49   0.000      1.80712    2.079387
                     1.asthma |      1.301   .0228837    14.96   0.000     1.256913    1.346633
    1.chronic_cardiac_disease |   1.408417   .0464712    10.38   0.000     1.320218    1.502509
                   1.diabetes |   1.785986   .0398752    25.98   0.000     1.709518    1.865875
                              |
            cancer_exhaem_cat |
                   Last year  |   1.946206    .181752     7.13   0.000     1.620679    2.337119
               2-5 years ago  |   1.253001   .0864827     3.27   0.001     1.094463    1.434503
                    5+ years  |   1.109589   .0608552     1.90   0.058     .9965018    1.235509
                              |
              cancer_haem_cat |
                   Last year  |    3.35635   .7039333     5.77   0.000     2.225068    5.062806
               2-5 years ago  |   3.228618   .4478894     8.45   0.000     2.459993      4.2374
                    5+ years  |   1.873463   .1985375     5.92   0.000      1.52209     2.30595
                              |
      1.chronic_liver_disease |   1.822225   .1242164     8.80   0.000     1.594328    2.082697
            1.stroke_dementia |    1.52086   .0849933     7.50   0.000     1.363075    1.696909
                1.other_neuro |   1.669802   .1046882     8.18   0.000     1.476722    1.888126
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   1.344764   .0681617     5.84   0.000     1.217591     1.48522
           Stage 4/5 egfr<30  |   3.871242   .4069605    12.88   0.000     3.150421    4.756988
                              |
                1.organ_trans |   1.726027   .2027202     4.65   0.000     1.371118    2.172803
                   1.asplenia |   2.559917   .3153612     7.63   0.000     2.010781    3.259021
                              |
                tot_adults_hh |
                           2  |    1.01789   .0196785     0.92   0.359     .9800421    1.057199
                           3  |   1.148605   .0224483     7.09   0.000     1.105439    1.193456
                              |
           1.ra_sle_psoriasis |   1.246047   .0365065     7.51   0.000     1.176511    1.319692
               1.other_immuno |   2.305208   .1874439    10.27   0.000     1.965604    2.703485
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
   1:     91.07 /        1 =      91.0720

         failure _d:  covid_tpp_prob
   analysis time _t:  (stime_covid_tpp_prob-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id
             weight:  [pweight=pw]

(sum of wgt is 12,492,921.190979)
Iteration 0:   log pseudolikelihood = -303880.32
Iteration 1:   log pseudolikelihood = -301467.93
Iteration 2:   log pseudolikelihood = -299353.55
Iteration 3:   log pseudolikelihood = -298990.69
Iteration 4:   log pseudolikelihood = -298928.82
Iteration 5:   log pseudolikelihood = -298924.98
Iteration 6:   log pseudolikelihood = -298924.96
Refining estimates:
Iteration 0:   log pseudolikelihood = -298924.96

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =   12,492,921             Number of obs    =     397,151
No. of failures      =       23,055
Time at risk         =   1697424492
                                                Wald chi2(39)    =     9603.97
Log pseudolikelihood =   -298924.96             Prob > chi2      =      0.0000

                                      (Std. Err. adjusted for 387,798 clusters in household_id)
-----------------------------------------------------------------------------------------------
                              |               Robust
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                    kids_cat3 |
               Kids under 12  |   1.046043   .0242544     1.94   0.052     .9995688    1.094677
               Kids under 18  |   1.128646   .0348122     3.92   0.000     1.062437    1.198981
                              |
                         age1 |   1.055206    .005179    10.95   0.000     1.045104    1.065405
                         age2 |   .9196363   .0146813    -5.25   0.000      .891307    .9488661
                         age3 |   1.080682   .0603672     1.39   0.165     .9686115     1.20572
                       1.male |   .7204329   .0127813   -18.48   0.000     .6958127    .7459244
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.321609    .025585    14.40   0.000     1.272403    1.372718
          Obese II (35-39.9)  |   1.477626   .0387817    14.88   0.000     1.403537    1.555626
             Obese III (40+)  |    1.61304   .0520225    14.82   0.000     1.514233    1.718294
                              |
                 smoke_nomiss |
                      Former  |   .9642655   .0155735    -2.25   0.024     .9342199    .9952773
                     Current  |   .5593915   .0123682   -26.27   0.000      .535668    .5841657
                              |
                          imd |
                           2  |   1.125666   .0275482     4.84   0.000     1.072947    1.180976
                           3  |   1.158746   .0286174     5.97   0.000     1.103992    1.216214
                           4  |   1.317894   .0317683    11.45   0.000     1.257077    1.381653
             5 most deprived  |   1.505267   .0376302    16.36   0.000     1.433291    1.580858
                              |
           1.htdiag_or_highbp |   1.189275   .0204254    10.09   0.000     1.149908    1.229989
1.chronic_respiratory_disease |   1.938072   .0693958    18.48   0.000     1.806722    2.078972
                     1.asthma |   1.300495   .0228794    14.93   0.000     1.256416    1.346119
    1.chronic_cardiac_disease |   1.410634   .0465621    10.42   0.000     1.322263    1.504911
                   1.diabetes |   1.786597   .0398965    25.99   0.000     1.710088    1.866529
                              |
            cancer_exhaem_cat |
                   Last year  |   1.946855   .1818258     7.13   0.000     1.621198    2.337929
               2-5 years ago  |   1.251898    .086431     3.25   0.001     1.093458    1.433296
                    5+ years  |   1.107228   .0607553     1.86   0.063     .9943295    1.232945
                              |
              cancer_haem_cat |
                   Last year  |   3.351503   .7032955     5.76   0.000     2.221363    5.056614
               2-5 years ago  |   3.227669   .4480852     8.44   0.000     2.458781    4.236997
                    5+ years  |   1.875757   .1988261     5.93   0.000     1.523881    2.308884
                              |
      1.chronic_liver_disease |   1.822124   .1242218     8.80   0.000     1.594219     2.08261
            1.stroke_dementia |   1.521822   .0850361     7.51   0.000     1.363956    1.697958
                1.other_neuro |   1.667698   .1046096     8.15   0.000     1.474769    1.885865
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   1.343862   .0681205     5.83   0.000     1.216766    1.484233
           Stage 4/5 egfr<30  |   3.873396   .4069491    12.89   0.000     3.152553    4.759061
                              |
                1.organ_trans |   1.725181   .2026732     4.64   0.000     1.370364    2.171867
                   1.asplenia |    2.56103   .3153299     7.64   0.000     2.011914    3.260017
                              |
                tot_adults_hh |
                           2  |   1.014066   .0197005     0.72   0.472     .9761798    1.053423
                           3  |   1.145288    .022451     6.92   0.000     1.102119    1.190147
                              |
           1.ra_sle_psoriasis |   1.245983   .0365088     7.51   0.000     1.176443    1.319633
               1.other_immuno |    2.30718   .1877917    10.27   0.000     1.966973    2.706229
                              |
               male#kids_cat3 |
             1#Kids under 12  |   1.080387   .0346298     2.41   0.016     1.014601    1.150437
             1#Kids under 18  |   .9981727   .0456258    -0.04   0.968     .9126366    1.091726
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
   1:     86.00 /        1 =      86.0040

 ( 1)  1.male#1.kids_cat3 = 0
 ( 2)  1.male#2.kids_cat3 = 0

           chi2(  2) =    6.15
         Prob > chi2 =    0.0461

kids_cat3 <66
****************

 ( 1)  2.kids_cat3 = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.128646   .0348122     3.92   0.000     1.062437    1.198981
------------------------------------------------------------------------------
kids_cat3 66+
****************

 ( 1)  2.kids_cat3 + 1.male#2.kids_cat3 = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.126583     .04227     3.18   0.001     1.046709    1.212553
------------------------------------------------------------------------------
(note: file ./output/an_interaction_cox_models_covid_tpp_prob_kids_cat3_male_MAINFULLYADJMODEL_agespline_bmicat_noeth.ster not fou
> nd)
file ./output/an_interaction_cox_models_covid_tpp_prob_kids_cat3_male_MAINFULLYADJMODEL_agespline_bmicat_noeth.ster saved

. 
. log close
      name:  <unnamed>
       log:  E:\analyses\school-age-children-and-covid\analysis\log\an_interaction_cox_models_covid_tpp_prob_sex.log
  log type:  text
 closed on:  24 Jul 2020, 13:47:04
----------------------------------------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\school-age-children-and-covid\analysis\log\an_interaction_cox_models_covid_death_sex.log
  log type:  text
 opened on:  24 Jul 2020, 13:43:51

. 
. 
. use "$tempdir\cr_create_analysis_dataset_STSET_`outcome'.dta", clear

. stset
-> stset stime_covid_death [pweight=pw], id(patient_id) failure(covid_death)
                           enter(time enter_date) origin(time enter_date)

                id:  patient_id
     failure event:  covid_death != 0 & covid_death < .
obs. time interval:  (stime_covid_death[_n-1], stime_covid_death]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date
            weight:  [pweight=pw]

------------------------------------------------------------------------------
    376,101  total observations
          0  exclusions
------------------------------------------------------------------------------
    376,101  observations remaining, representing
    376,101  subjects
      1,380  failures in single-failure-per-subject data
   51052388  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       136

. 
.         
. *PROG TO DEFINE THE BASIC COX MODEL WITH OPTIONS FOR HANDLING OF AGE, BMI, ETHNICITY:
. cap prog drop basemodel

. prog define basemodel
  1.         syntax , exposure(string)  age(string) [ethnicity(real 0) interaction(string)] 
  2.         if `ethnicity'==1 local ethnicity "i.ethnicity"
  3.         else local ethnicity
  4. timer clear
  5. timer on 1
  6.  stcox  `exposure' `age'                                        ///
>                         i.male                                                  ///
>                         i.obese4cat                                             ///
>                         i.smoke_nomiss                                  ///
>                         i.imd                                                   ///
>                         i.htdiag_or_highbp                              ///
>                         i.chronic_respiratory_disease   ///
>                         i.asthma                                                ///
>                         i.chronic_cardiac_disease               ///
>                         i.diabetes                                              ///
>                         i.cancer_exhaem_cat                             ///
>                         i.cancer_haem_cat                               ///
>                         i.chronic_liver_disease                 ///
>                         i.stroke_dementia                               ///
>                         i.other_neuro                                   ///
>                         i.reduced_kidney_function_cat   ///
>                         i.organ_trans                           ///
>                         i.asplenia                                              ///
>                         i.tot_adults_hh                         ///
>                         i.ra_sle_psoriasis                      ///
>                         i.other_immuno                  ///
>                         `interaction'                                                   ///
>                         , strata(stp) vce(cluster household_id)
  7.         timer off 1
  8. timer list
  9. end

. *************************************************************************************
. 
. foreach int_type in  male  {
  2. 
. *Age interaction for 3-level exposure vars
. foreach exposure_type in kids_cat3  {
  3. 
. *Age spline model (not adj ethnicity, no interaction)
. basemodel, exposure("i.`exposure_type'") age("age1 age2 age3")  
  4. 
. *Age spline model (not adj ethnicity, interaction)
. basemodel, exposure("i.`exposure_type'") age("age1 age2 age3") interaction(1.`int_type'#1.`exposure_type' 1.`int_type'#2.`exposu
> re_type')
  5. if _rc==0{
  6. testparm 1.`int_type'#i.`exposure_type'
  7. di _n "`exposure_type' <66" _n "****************"
  8. lincom 2.`exposure_type', eform
  9. di "`exposure_type' 66+" _n "****************"
 10. lincom 2.`exposure_type' + 1.`int_type'#2.`exposure_type', eform
 11. estimates save ./output/an_interaction_cox_models_`outcome'_`exposure_type'_`int_type'_MAINFULLYADJMODEL_agespline_bmicat_noe
> th, replace
 12. }
 13. else di "WARNING GROUP MODEL DID NOT FIT (OUTCOME `outcome')"
 14. 
. }
 15. 
. /*Age interactions with 4-level vars: NOT in protocol - do not run
> foreach exposure_type in gp_number_kids {
> basemodel, exposure("i.`exposure_type'") age("age1 age2 age3")  bp("i.htdiag_or_highbp") ethnicity(0) interaction(1.`int_type'#1
> .`exposure_type' 1.`int_type'#2.`exposure_type' 1.`int_type'#3.`exposure_type' 1.`int_type'#4.`exposure_type')
> if _rc==0{
> testparm 1.`int_type'#i.`exposure_type'
> di _n "`exposure_type' <66" _n "****************"
> lincom 2.`exposure_type', eform
> lincom 3.`exposure_type', eform
> lincom 4.`exposure_type', eform
> di "`exposure_type' 66+" _n "****************"
> lincom 2.`exposure_type' + 1.`int_type'#2.`exposure_type', eform
> lincom 3.`exposure_type' + 1.`int_type'#3.`exposure_type', eform
> lincom 4.`exposure_type' + 1.`int_type'#4.`exposure_type', eform
> estimates save ./output/an_interaction_cox_models_`outcome'_`exposure_type'_`int_type'_MAINFULLYADJMODEL_agespline_bmicat_noeth,
>  replace
> }
> else di "WARNING GROUP MODEL DID NOT FIT (OUTCOME `outcome')"
> }
> */
. 
. }

         failure _d:  covid_death
   analysis time _t:  (stime_covid_death-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id
             weight:  [pweight=pw]

(sum of wgt is 12,492,079.523518)
Iteration 0:   log pseudolikelihood = -18182.637
Iteration 1:   log pseudolikelihood =  -17838.83
Iteration 2:   log pseudolikelihood = -17515.087
Iteration 3:   log pseudolikelihood = -16303.597
Iteration 4:   log pseudolikelihood =  -16102.33
Iteration 5:   log pseudolikelihood =  -16097.94
Iteration 6:   log pseudolikelihood = -16097.917
Iteration 7:   log pseudolikelihood = -16097.917
Refining estimates:
Iteration 0:   log pseudolikelihood = -16097.917

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =   12,492,080             Number of obs    =     376,101
No. of failures      =        1,380
Time at risk         =   1698315732
                                                Wald chi2(37)    =     4352.85
Log pseudolikelihood =   -16097.917             Prob > chi2      =      0.0000

                                      (Std. Err. adjusted for 368,774 clusters in household_id)
-----------------------------------------------------------------------------------------------
                              |               Robust
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                    kids_cat3 |
               Kids under 12  |   .8330252   .0834989    -1.82   0.068     .6844432    1.013862
               Kids under 18  |   .9836872   .1101776    -0.15   0.883     .7898023    1.225168
                              |
                         age1 |   1.188771   .0590403     3.48   0.000     1.078507    1.310307
                         age2 |   .8587415   .1144845    -1.14   0.253     .6612766    1.115172
                         age3 |   1.179892   .4503366     0.43   0.665     .5584177    2.493019
                       1.male |   1.899101   .1154593    10.55   0.000     1.685767    2.139431
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.203376   .0907487     2.45   0.014     1.038032    1.395056
          Obese II (35-39.9)  |   1.832689   .1710721     6.49   0.000     1.526278    2.200615
             Obese III (40+)  |   1.998464   .2266137     6.11   0.000     1.600203    2.495844
                              |
                 smoke_nomiss |
                      Former  |   .9962694     .06363    -0.06   0.953     .8790468    1.129124
                     Current  |   .6415103    .057101    -4.99   0.000     .5388128    .7637819
                              |
                          imd |
                           2  |   1.191559   .1274936     1.64   0.101     .9661381    1.469575
                           3  |   1.328221   .1390921     2.71   0.007     1.081762     1.63083
                           4  |   1.883284   .1866512     6.39   0.000     1.550793    2.287062
             5 most deprived  |   1.914933   .2027821     6.14   0.000     1.556021    2.356631
                              |
           1.htdiag_or_highbp |   1.245891   .0807303     3.39   0.001     1.097298    1.414606
1.chronic_respiratory_disease |   2.582724   .2414158    10.15   0.000     2.150371    3.102006
                     1.asthma |   1.145027   .0857535     1.81   0.071      .988707    1.326063
    1.chronic_cardiac_disease |   1.604481   .1378094     5.50   0.000      1.35589    1.898648
                   1.diabetes |   2.406937   .1680305    12.58   0.000     2.099141    2.759865
                              |
            cancer_exhaem_cat |
                   Last year  |   4.203025   .8381501     7.20   0.000     2.843274    6.213053
               2-5 years ago  |   2.569658   .4033656     6.01   0.000     1.889123    3.495349
                    5+ years  |   1.509072   .2372161     2.62   0.009     1.108937    2.053587
                              |
              cancer_haem_cat |
                   Last year  |   5.864755   2.594942     4.00   0.000     2.463905    13.95969
               2-5 years ago  |   7.342466   1.953825     7.49   0.000     4.358508    12.36933
                    5+ years  |    2.28864   .6591035     2.87   0.004     1.301489    4.024522
                              |
      1.chronic_liver_disease |    3.50814   .5568367     7.91   0.000     2.570208    4.788347
            1.stroke_dementia |   1.708671   .2377247     3.85   0.000     1.300865     2.24432
                1.other_neuro |   5.001294   .7073189    11.38   0.000     3.790525    6.598807
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   2.411439    .259287     8.19   0.000     1.953223     2.97715
           Stage 4/5 egfr<30  |   9.938645   1.731963    13.18   0.000     7.063047    13.98499
                              |
                1.organ_trans |    1.86105   .4470518     2.59   0.010     1.162216    2.980089
                   1.asplenia |   1.372276   .6480046     0.67   0.503     .5438692    3.462491
                              |
                tot_adults_hh |
                           2  |   .8145005   .0625986    -2.67   0.008     .7006032    .9469141
                           3  |   1.123182   .0834091     1.56   0.118     .9710434    1.299157
                              |
           1.ra_sle_psoriasis |   1.323115   .1360056     2.72   0.006     1.081685    1.618431
               1.other_immuno |   2.650664   .6264716     4.12   0.000     1.667928    4.212423
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
   1:    133.35 /        1 =     133.3550

         failure _d:  covid_death
   analysis time _t:  (stime_covid_death-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id
             weight:  [pweight=pw]

(sum of wgt is 12,492,079.523518)
Iteration 0:   log pseudolikelihood = -18182.637
Iteration 1:   log pseudolikelihood = -17838.088
Iteration 2:   log pseudolikelihood = -17518.193
Iteration 3:   log pseudolikelihood = -16293.719
Iteration 4:   log pseudolikelihood = -16096.404
Iteration 5:   log pseudolikelihood = -16092.219
Iteration 6:   log pseudolikelihood = -16092.197
Iteration 7:   log pseudolikelihood = -16092.197
Refining estimates:
Iteration 0:   log pseudolikelihood = -16092.197

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =   12,492,080             Number of obs    =     376,101
No. of failures      =        1,380
Time at risk         =   1698315732
                                                Wald chi2(39)    =     4288.54
Log pseudolikelihood =   -16092.197             Prob > chi2      =      0.0000

                                      (Std. Err. adjusted for 368,774 clusters in household_id)
-----------------------------------------------------------------------------------------------
                              |               Robust
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                    kids_cat3 |
               Kids under 12  |   .6089283   .1064567    -2.84   0.005     .4322686    .8577854
               Kids under 18  |   .6437225   .1380696    -2.05   0.040     .4227929    .9800983
                              |
                         age1 |   1.194005   .0591953     3.58   0.000     1.083443     1.31585
                         age2 |   .8454298   .1124895    -1.26   0.207     .6513584    1.097324
                         age3 |   1.240832   .4726908     0.57   0.571     .5880994    2.618034
                       1.male |   1.736827   .1161733     8.25   0.000     1.523426    1.980122
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.205654   .0909314     2.48   0.013     1.039979    1.397723
          Obese II (35-39.9)  |   1.844623   .1720213     6.57   0.000     1.536485    2.214557
             Obese III (40+)  |   1.997566    .227099     6.09   0.000     1.598563     2.49616
                              |
                 smoke_nomiss |
                      Former  |   .9958004   .0635406    -0.07   0.947     .8787358     1.12846
                     Current  |   .6400428   .0569445    -5.02   0.000     .5376229    .7619742
                              |
                          imd |
                           2  |   1.192729    .127757     1.65   0.100     .9668676    1.471353
                           3  |   1.330004     .13931     2.72   0.006     1.083165    1.633094
                           4  |   1.886375   .1870082     6.40   0.000     1.553256    2.290936
             5 most deprived  |   1.924644    .203775     6.18   0.000     1.563968    2.368496
                              |
           1.htdiag_or_highbp |   1.245058   .0804991     3.39   0.001      1.09687    1.413266
1.chronic_respiratory_disease |   2.576084   .2411295    10.11   0.000     2.144297    3.094818
                     1.asthma |   1.145492   .0857635     1.81   0.070     .9891502    1.326545
    1.chronic_cardiac_disease |   1.608997   .1381819     5.54   0.000     1.359732    1.903956
                   1.diabetes |   2.407827   .1680278    12.59   0.000     2.100028     2.76074
                              |
            cancer_exhaem_cat |
                   Last year  |   4.211178   .8412039     7.20   0.000     2.846898    6.229245
               2-5 years ago  |   2.554505    .402794     5.95   0.000     1.875381    3.479558
                    5+ years  |   1.504272   .2365127     2.60   0.009     1.105335    2.047191
                              |
              cancer_haem_cat |
                   Last year  |   5.708478   2.533452     3.93   0.000     2.391953    13.62348
               2-5 years ago  |   7.383836    1.96502     7.51   0.000     4.382849    12.43964
                    5+ years  |   2.289911   .6580195     2.88   0.004     1.303829    4.021762
                              |
      1.chronic_liver_disease |   3.522583   .5570597     7.96   0.000     2.583763    4.802528
            1.stroke_dementia |   1.705772   .2368132     3.85   0.000     1.299416    2.239204
                1.other_neuro |   4.994342   .7071351    11.36   0.000     3.784068    6.591702
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   2.402196   .2585327     8.14   0.000     1.945356    2.966318
           Stage 4/5 egfr<30  |   9.932706   1.722139    13.24   0.000     7.071078    13.95242
                              |
                1.organ_trans |   1.873113   .4492335     2.62   0.009     1.170625    2.997159
                   1.asplenia |   1.392963   .6559922     0.70   0.482     .5534532    3.505891
                              |
                tot_adults_hh |
                           2  |   .8057004   .0620755    -2.80   0.005     .6927753    .9370327
                           3  |   1.112964   .0829607     1.44   0.151     .9616835    1.288042
                              |
           1.ra_sle_psoriasis |   1.321105   .1360462     2.70   0.007     1.079646    1.616566
               1.other_immuno |   2.673137   .6335932     4.15   0.000     1.679838     4.25378
                              |
               male#kids_cat3 |
             1#Kids under 12  |   1.578864   .3149271     2.29   0.022     1.067973    2.334152
             1#Kids under 18  |   1.824045   .4488533     2.44   0.015     1.126096    2.954579
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
   1:    126.72 /        1 =     126.7230

 ( 1)  1.male#1.kids_cat3 = 0
 ( 2)  1.male#2.kids_cat3 = 0

           chi2(  2) =   10.27
         Prob > chi2 =    0.0059

kids_cat3 <66
****************

 ( 1)  2.kids_cat3 = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .6437225   .1380696    -2.05   0.040     .4227929    .9800983
------------------------------------------------------------------------------
kids_cat3 66+
****************

 ( 1)  2.kids_cat3 + 1.male#2.kids_cat3 = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.174179   .1518145     1.24   0.214     .9113366    1.512828
------------------------------------------------------------------------------
(note: file ./output/an_interaction_cox_models_covid_death_kids_cat3_male_MAINFULLYADJMODEL_agespline_bmicat_noeth.ster not found)
file ./output/an_interaction_cox_models_covid_death_kids_cat3_male_MAINFULLYADJMODEL_agespline_bmicat_noeth.ster saved

. 
. log close
      name:  <unnamed>
       log:  E:\analyses\school-age-children-and-covid\analysis\log\an_interaction_cox_models_covid_death_sex.log
  log type:  text
 closed on:  24 Jul 2020, 13:48:29
----------------------------------------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\school-age-children-and-covid\analysis\log\an_multivariableFULL_cox_models_covid_tpp_probSense1.log
  log type:  text
 opened on:  24 Jul 2020, 13:43:51

. 
. use "$tempdir\cr_create_analysis_dataset_STSET_`outcome'.dta", clear

. 
. 
. ******************************
. *  Multivariable Cox models  *
. ******************************
. 
. *************************************************************************************
. *PROG TO DEFINE THE BASIC COX MODEL WITH OPTIONS FOR HANDLING OF AGE, BMI, ETHNICITY:
. cap prog drop basecoxmodel

. prog define basecoxmodel
  1.         syntax , exposure(string) age(string) [ethnicity(real 0) if(string)] bmi(string) smoking(string)
  2. 
.         if `ethnicity'==1 local ethnicity "i.ethnicity"
  3.         else local ethnicity
  4. timer clear
  5. timer on 1
  6.         capture stcox   `exposure' `age'                ///
>                         i.male                                                  ///
>                         `bmi'                                                   ///
>                         `smoking'                                               ///
>                         `ethnicity'                                             ///
>                         i.imd                                                   ///
>                         i.htdiag_or_highbp                              ///
>                         i.chronic_respiratory_disease   ///
>                         i.asthma                                                ///
>                         i.chronic_cardiac_disease               ///
>                         i.diabetes                                              ///
>                         i.cancer_exhaem_cat                             ///
>                         i.cancer_haem_cat                               ///
>                         i.chronic_liver_disease                 ///
>                         i.stroke_dementia                               ///
>                         i.other_neuro                                   ///
>                         i.reduced_kidney_function_cat   ///
>                         i.organ_trans                                   ///
>                         i.tot_adults_hh                                 ///
>                         i.asplenia                                              ///
>                         i.ra_sle_psoriasis                      ///
>                         i.other_immuno                                  ///
>                         `if'                                                    ///
>                         , strata(stp) vce(cluster household_id)
  7. timer off 1
  8. timer list
  9. end

. *************************************************************************************
. 
. foreach exposure_type in        kids_cat3  ///
>                 gp_number_kids {
  2. 
. 
. *Complete case ethnicity model
. basecoxmodel, exposure("i.`exposure_type'") age("age1 age2 age3") ethnicity(1) bmi(i.obese4cat) smoking(i.smoke_nomiss)
  3. if _rc==0{
  4. estimates
  5. estimates save ./output/an_multivariate_cox_models_`outcome'_`exposure_type'_MAINFULLYADJMODEL_CCeth, replace
  6. *estat concordance /*c-statistic*/
.  }
  7.  else di "WARNING CC ETHNICITY MODEL WITH AGESPLINE DID NOT FIT (OUTCOME `outcome')"
  8. 
.  }
   1:     82.33 /        1 =      82.3350

----------------------------------------------------------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =    9,529,416             Number of obs    =     303,811
No. of failures      =       18,483
Time at risk         =   1294733332
                                                Wald chi2(41)    =     8357.35
Log pseudolikelihood =   -234474.68             Prob > chi2      =      0.0000

                                      (Std. Err. adjusted for 297,839 clusters in household_id)
-----------------------------------------------------------------------------------------------
                              |               Robust
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                    kids_cat3 |
               Kids under 12  |   .9636431    .020423    -1.75   0.081     .9244347    1.004514
               Kids under 18  |   1.078874   .0305892     2.68   0.007     1.020556    1.140525
                              |
                         age1 |   1.044364   .0059225     7.65   0.000     1.032821    1.056037
                         age2 |   .9513249   .0173933    -2.73   0.006     .9178382    .9860333
                         age3 |   .9689289   .0616428    -0.50   0.620     .8553401    1.097602
                       1.male |   .7599102   .0120646   -17.29   0.000     .7366282    .7839281
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.321218   .0282767    13.02   0.000     1.266943    1.377818
          Obese II (35-39.9)  |   1.513663   .0443875    14.14   0.000     1.429118     1.60321
             Obese III (40+)  |   1.739827   .0625645    15.40   0.000     1.621425    1.866876
                              |
                 smoke_nomiss |
                      Former  |   1.039472   .0190731     2.11   0.035     1.002753    1.077535
                     Current  |   .6128134   .0154103   -19.47   0.000      .583342    .6437738
                              |
                    ethnicity |
                       Mixed  |     1.6354   .0911766     8.82   0.000     1.466115    1.824233
      Asian or Asian British  |   2.421574   .0627182    34.15   0.000     2.301716    2.547673
                       Black  |    1.85689   .0706009    16.28   0.000     1.723545    2.000551
                       Other  |   1.517048   .0691291     9.15   0.000     1.387432    1.658774
                              |
                          imd |
                           2  |   1.112367   .0308574     3.84   0.000     1.053503    1.174521
                           3  |   1.098002   .0306758     3.35   0.001     1.039495    1.159802
                           4  |    1.18593   .0325429     6.21   0.000     1.123832    1.251459
             5 most deprived  |   1.319777   .0377404     9.70   0.000     1.247842    1.395859
                              |
           1.htdiag_or_highbp |   1.204511   .0232019     9.66   0.000     1.159883    1.250855
1.chronic_respiratory_disease |   1.942879   .0783976    16.46   0.000     1.795142    2.102775
                     1.asthma |   1.344774    .026566    15.00   0.000     1.293701    1.397864
    1.chronic_cardiac_disease |    1.41674    .052498     9.40   0.000     1.317494    1.523463
                   1.diabetes |   1.538641   .0386602    17.15   0.000     1.464704    1.616311
                              |
            cancer_exhaem_cat |
                   Last year  |   1.893487    .200466     6.03   0.000     1.538666     2.33013
               2-5 years ago  |   1.196967    .094078     2.29   0.022     1.026078    1.396317
                    5+ years  |   1.139284   .0710197     2.09   0.036     1.008256    1.287341
                              |
              cancer_haem_cat |
                   Last year  |   4.137354   .9765182     6.02   0.000     2.605061    6.570938
               2-5 years ago  |   2.953256    .475325     6.73   0.000     2.154272    4.048568
                    5+ years  |    1.85332   .2241857     5.10   0.000     1.462128    2.349176
                              |
      1.chronic_liver_disease |   1.654776   .1255161     6.64   0.000     1.426182     1.92001
            1.stroke_dementia |   1.547995   .0973992     6.94   0.000     1.368397    1.751164
                1.other_neuro |   1.635799   .1182204     6.81   0.000     1.419753     1.88472
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   1.257757    .073406     3.93   0.000     1.121808    1.410182
           Stage 4/5 egfr<30  |   3.811597   .4617738    11.04   0.000     3.005966    4.833144
                              |
                1.organ_trans |   1.668473   .2261658     3.78   0.000     1.279194    2.176214
                              |
                tot_adults_hh |
                           2  |    1.02157   .0220302     0.99   0.322     .9792918    1.065674
                           3  |   1.075691   .0237228     3.31   0.001     1.030185    1.123206
                              |
                   1.asplenia |   2.537246    .354588     6.66   0.000     1.929321    3.336726
           1.ra_sle_psoriasis |   1.239704   .0410586     6.49   0.000     1.161787    1.322846
               1.other_immuno |   1.983958   .1749805     7.77   0.000     1.669008     2.35834
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/an_multivariate_cox_models_covid_tpp_prob_kids_cat3_MAINFULLYADJMODEL_CCeth.ster not found)
file ./output/an_multivariate_cox_models_covid_tpp_prob_kids_cat3_MAINFULLYADJMODEL_CCeth.ster saved
   1:     73.63 /        1 =      73.6330

----------------------------------------------------------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =    9,529,416             Number of obs    =     303,811
No. of failures      =       18,483
Time at risk         =   1294733332
                                                Wald chi2(43)    =     8374.09
Log pseudolikelihood =   -234472.49             Prob > chi2      =      0.0000

                                      (Std. Err. adjusted for 297,839 clusters in household_id)
-----------------------------------------------------------------------------------------------
                              |               Robust
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
               gp_number_kids |
              only >12 years  |   1.078744   .0305859     2.67   0.008     1.020432    1.140388
                 1 child <12  |    .987971   .0248245    -0.48   0.630     .9404945    1.037844
              2 children <12  |   .9271245   .0284678    -2.46   0.014     .8729744    .9846336
             3+ children <12  |   .9502598   .0464984    -1.04   0.297     .8633583    1.045908
                              |
                         age1 |   1.045262   .0059432     7.79   0.000     1.033678    1.056975
                         age2 |   .9485156   .0173941    -2.88   0.004     .9150292    .9832274
                         age3 |   .9786736   .0624341    -0.34   0.735     .8636461    1.109022
                       1.male |   .7600338   .0120672   -17.28   0.000     .7367467    .7840569
                              |
                    obese4cat |
           Obese I (30-34.9)  |   1.321508   .0282887    13.02   0.000      1.26721    1.378133
          Obese II (35-39.9)  |   1.513816   .0443802    14.14   0.000     1.429284    1.603347
             Obese III (40+)  |   1.739682   .0625548    15.40   0.000     1.621297    1.866711
                              |
                 smoke_nomiss |
                      Former  |   1.039232   .0190698     2.10   0.036      1.00252    1.077288
                     Current  |   .6125116   .0154081   -19.49   0.000     .5830447    .6434677
                              |
                    ethnicity |
                       Mixed  |   1.634841   .0911715     8.81   0.000     1.465568    1.823665
      Asian or Asian British  |    2.42347   .0627669    34.18   0.000     2.303519    2.549666
                       Black  |   1.858427   .0706932    16.29   0.000      1.72491    2.002279
                       Other  |   1.517343   .0691406     9.15   0.000     1.387705    1.659092
                              |
                          imd |
                           2  |    1.11193   .0308497     3.82   0.000     1.053081    1.174069
                           3  |   1.097333   .0306639     3.32   0.001     1.038849     1.15911
                           4  |   1.185172   .0325261     6.19   0.000     1.123106    1.250668
             5 most deprived  |   1.319173   .0377474     9.68   0.000     1.247226     1.39527
                              |
           1.htdiag_or_highbp |   1.204332   .0231951     9.65   0.000     1.159718    1.250663
1.chronic_respiratory_disease |   1.943238   .0783853    16.47   0.000     1.795522    2.103107
                     1.asthma |   1.345136    .026572    15.01   0.000     1.294051    1.398237
    1.chronic_cardiac_disease |   1.417155   .0525054     9.41   0.000     1.317894    1.523892
                   1.diabetes |   1.538474   .0386597    17.14   0.000     1.464538    1.616143
                              |
            cancer_exhaem_cat |
                   Last year  |   1.893956   .2005532     6.03   0.000     1.538988    2.330798
               2-5 years ago  |   1.196402   .0940256     2.28   0.023     1.025607     1.39564
                    5+ years  |   1.139324   .0710325     2.09   0.036     1.008273    1.287409
                              |
              cancer_haem_cat |
                   Last year  |   4.148228   .9790719     6.03   0.000     2.611924    6.588168
               2-5 years ago  |   2.955205   .4756935     6.73   0.000     2.155616    4.051388
                    5+ years  |   1.853579   .2242384     5.10   0.000     1.462299    2.349557
                              |
      1.chronic_liver_disease |    1.65491   .1255798     6.64   0.000     1.426207    1.920288
            1.stroke_dementia |   1.547486   .0973693     6.94   0.000     1.367944    1.750593
                1.other_neuro |   1.635289   .1181801     6.81   0.000     1.419317    1.884125
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   1.257471   .0733929     3.93   0.000     1.121547    1.409869
           Stage 4/5 egfr<30  |   3.815853   .4614854    11.07   0.000     3.010566    4.836544
                              |
                1.organ_trans |   1.667297   .2257613     3.78   0.000     1.278662    2.174055
                              |
                tot_adults_hh |
                           2  |   1.023176   .0220817     1.06   0.288      .980799    1.067384
                           3  |   1.076039   .0237308     3.32   0.001     1.030518     1.12357
                              |
                   1.asplenia |   2.538593   .3547067     6.67   0.000     1.930449    3.338319
           1.ra_sle_psoriasis |   1.239508   .0410559     6.48   0.000     1.161596    1.322645
               1.other_immuno |   1.980866   .1747749     7.75   0.000     1.666296    2.354821
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/an_multivariate_cox_models_covid_tpp_prob_gp_number_kids_MAINFULLYADJMODEL_CCeth.ster not found)
file ./output/an_multivariate_cox_models_covid_tpp_prob_gp_number_kids_MAINFULLYADJMODEL_CCeth.ster saved

. 
. 
. log close
      name:  <unnamed>
       log:  E:\analyses\school-age-children-and-covid\analysis\log\an_multivariableFULL_cox_models_covid_tpp_probSense1.log
  log type:  text
 closed on:  24 Jul 2020, 13:46:33
----------------------------------------------------------------------------------------------------------------------------------
